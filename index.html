<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hinnanmuutos ja Kysynnän Jousto - Simulaattori</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        input[type=range] {
            height: 6px;
            -webkit-appearance: none;
            background: #e2e8f0;
            border-radius: 5px;
            background-image: linear-gradient(#3b82f6, #3b82f6);
            background-repeat: no-repeat;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 18px;
            width: 18px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            box-shadow: 0 0 2px 0 rgba(0,0,0,0.5);
            transition: background .3s ease-in-out;
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans min-h-screen">

    <div class="max-w-6xl mx-auto px-4 py-10">
        <!-- Header -->
        <header class="mb-10 text-center">
            <h1 class="text-3xl font-bold text-slate-800 mb-2">Hinnanmuutoksen Simulaattori</h1>
            <p class="text-slate-600">Analysoi hinnan laskun vaikutusta myyntivolyymiin ja löydä optimaalinen hintapiste.</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Controls Sidebar -->
            <div class="lg:col-span-1 bg-white p-6 rounded-2xl shadow-sm border border-slate-200 space-y-8 h-fit">
                <!-- Alkuperäinen hinta -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-sm font-semibold text-slate-700">Alkuperäinen hinta (€)</label>
                        <input type="number" id="origPriceNum" value="100" class="w-20 text-right text-sm font-bold text-blue-600 border border-slate-200 rounded px-1 py-0.5 focus:outline-none focus:ring-1 focus:ring-blue-500">
                    </div>
                    <input type="range" id="origPrice" min="1" max="1000" value="100" class="w-full cursor-pointer">
                </div>

                <!-- Uusi hinta -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-sm font-semibold text-slate-700">Simuloitu hinta (€)</label>
                        <input type="number" id="newPriceNum" value="90" class="w-20 text-right text-sm font-bold text-blue-600 border border-slate-200 rounded px-1 py-0.5 focus:outline-none focus:ring-1 focus:ring-blue-500">
                    </div>
                    <input type="range" id="newPrice" min="1" max="1000" value="90" class="w-full cursor-pointer">
                    <p id="priceChangePct" class="text-xs mt-1 text-slate-500 italic"></p>
                </div>

                <!-- Alkuperäinen volyymi -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-sm font-semibold text-slate-700">Alkuperäinen volyymi (kpl)</label>
                        <input type="number" id="origVolNum" value="1000" class="w-20 text-right text-sm font-bold text-blue-600 border border-slate-200 rounded px-1 py-0.5 focus:outline-none focus:ring-1 focus:ring-blue-500">
                    </div>
                    <input type="range" id="origVol" min="10" max="10000" step="10" value="1000" class="w-full cursor-pointer">
                </div>

                <!-- Hintajousto -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-sm font-semibold text-slate-700">Kysynnän hintajousto</label>
                        <input type="number" id="elasticityNum" value="1.5" step="0.1" class="w-20 text-right text-sm font-bold text-blue-600 border border-slate-200 rounded px-1 py-0.5 focus:outline-none focus:ring-1 focus:ring-blue-500">
                    </div>
                    <input type="range" id="elasticity" min="0" max="5" step="0.1" value="1.5" class="w-full cursor-pointer">
                    <p class="text-[10px] text-slate-400 mt-2 leading-tight">
                        Esim. 1.5 tarkoittaa, että 10% hinnanlasku kasvattaa volyymia 15%.
                    </p>
                </div>
            </div>

            <!-- Dashboard / Results -->
            <div class="lg:col-span-2 space-y-6">
                
                <!-- Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Revenue Card -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                        <h3 class="text-slate-500 text-sm font-medium uppercase tracking-wider mb-4">Uusi Liikevaihto</h3>
                        <div class="flex items-baseline space-x-2">
                            <span id="newRevenue" class="text-4xl font-black text-slate-800">0 €</span>
                        </div>
                        <div id="revenueDiff" class="mt-2 text-sm font-semibold"></div>
                    </div>

                    <!-- Volume Card -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                        <h3 class="text-slate-500 text-sm font-medium uppercase tracking-wider mb-4">Uusi Volyymi</h3>
                        <div class="flex items-baseline space-x-2">
                            <span id="newVol" class="text-4xl font-black text-slate-800">0 kpl</span>
                        </div>
                        <div id="volDiff" class="mt-2 text-sm font-semibold text-blue-600"></div>
                    </div>

                    <!-- Optimal Price Card -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 border-l-4 border-l-blue-500">
                        <h3 class="text-slate-500 text-sm font-medium uppercase tracking-wider mb-4">Optimi (Max LV)</h3>
                        <div class="flex items-baseline space-x-2">
                            <span id="optPrice" class="text-3xl font-black text-blue-600">0 €</span>
                        </div>
                        <p class="text-[10px] text-slate-400 mt-2">Hinta, joka maksimoi liikevaihdon.</p>
                    </div>
                </div>

                <!-- Chart Section -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <h3 class="text-slate-700 text-sm font-bold mb-4 uppercase">Liikevaihtokäyrä ja Optimi</h3>
                    <div class="h-64">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>

                <!-- Detailed Comparison Table -->
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                    <table class="w-full text-left text-sm">
                        <thead class="bg-slate-50 border-bottom border-slate-200">
                            <tr>
                                <th class="px-6 py-4 font-bold text-slate-500 uppercase">Metriikka</th>
                                <th class="px-6 py-4 font-bold text-slate-500 uppercase text-right">Nykyinen</th>
                                <th class="px-6 py-4 font-bold text-slate-500 uppercase text-right">Simuloitu</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100">
                            <tr>
                                <td class="px-6 py-4 text-slate-600 italic">Hinta</td>
                                <td id="tableOrigPrice" class="px-6 py-4 font-medium text-right text-slate-400">0 €</td>
                                <td id="tableNewPrice" class="px-6 py-4 font-bold text-right text-blue-600">0 €</td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 text-slate-600 italic">Volyymi</td>
                                <td id="tableOrigVol" class="px-6 py-4 font-medium text-right text-slate-400">0 kpl</td>
                                <td id="tableNewVol" class="px-6 py-4 font-bold text-right text-blue-600">0 kpl</td>
                            </tr>
                            <tr class="bg-slate-50/50">
                                <td class="px-6 py-4 font-bold text-slate-800 uppercase">Liikevaihto</td>
                                <td id="tableOrigRev" class="px-6 py-4 font-bold text-right text-slate-400">0 €</td>
                                <td id="tableNewRev" class="px-6 py-4 font-bold text-right text-green-600">0 €</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="insightBox" class="p-4 rounded-xl text-sm"></div>
            </div>
        </div>
    </div>

    <script>
        let revenueChart = null;

        const inputs = {
            origPrice: document.getElementById('origPrice'),
            origPriceNum: document.getElementById('origPriceNum'),
            newPrice: document.getElementById('newPrice'),
            newPriceNum: document.getElementById('newPriceNum'),
            origVol: document.getElementById('origVol'),
            origVolNum: document.getElementById('origVolNum'),
            elasticity: document.getElementById('elasticity'),
            elasticityNum: document.getElementById('elasticityNum')
        };

        const displays = {
            priceChangePct: document.getElementById('priceChangePct'),
            newRevenue: document.getElementById('newRevenue'),
            revenueDiff: document.getElementById('revenueDiff'),
            newVol: document.getElementById('newVol'),
            volDiff: document.getElementById('volDiff'),
            optPrice: document.getElementById('optPrice'),
            tableOrigPrice: document.getElementById('tableOrigPrice'),
            tableNewPrice: document.getElementById('tableNewPrice'),
            tableOrigVol: document.getElementById('tableOrigVol'),
            tableNewVol: document.getElementById('tableNewVol'),
            tableOrigRev: document.getElementById('tableOrigRev'),
            tableNewRev: document.getElementById('tableNewRev'),
            insightBox: document.getElementById('insightBox')
        };

        function formatEuro(val) {
            return new Intl.NumberFormat('fi-FI', { style: 'currency', currency: 'EUR' }).format(val);
        }

        function formatNum(val) {
            return new Intl.NumberFormat('fi-FI').format(Math.round(val));
        }

        function calculate() {
            const p1 = parseFloat(inputs.origPrice.value);
            const p2 = parseFloat(inputs.newPrice.value);
            const v1 = parseFloat(inputs.origVol.value);
            const e = parseFloat(inputs.elasticity.value);

            if (isNaN(p1) || isNaN(p2) || isNaN(v1) || isNaN(e)) return;

            // Update range backgrounds
            [inputs.origPrice, inputs.newPrice, inputs.origVol, inputs.elasticity].forEach(input => {
                const val = (input.value - input.min) / (input.max - input.min) * 100;
                input.style.backgroundSize = val + '% 100%';
            });

            // Mathematical Model: V2 = V1 * (1 + e * (P1 - P2) / P1)
            const getVol = (price) => Math.max(0, v1 * (1 + e * (p1 - price) / p1));
            const getRev = (price) => price * getVol(price);

            const v2 = getVol(p2);
            const r1 = p1 * v1;
            const r2 = getRev(p2);
            const revDiff = r2 - r1;
            const revDiffPct = (revDiff / r1) * 100;

            // Optimal Price Calculation
            let optimalPrice = 0;
            if (e > 0) {
                optimalPrice = p1 * (1 + e) / (2 * e);
            } else {
                optimalPrice = parseFloat(inputs.origPrice.max);
            }

            if (displays.optPrice) displays.optPrice.textContent = formatEuro(optimalPrice);
            if (displays.priceChangePct) displays.priceChangePct.textContent = `Hinnan muutos: ${(((p2-p1)/p1)*100).toFixed(1)}%`;
            
            // Update New Revenue
            if (displays.newRevenue) displays.newRevenue.textContent = formatEuro(r2);
            if (displays.revenueDiff) {
                if (revDiff >= 0) {
                    displays.revenueDiff.textContent = `+${formatEuro(revDiff)} (+${revDiffPct.toFixed(1)}%)`;
                    displays.revenueDiff.className = "mt-2 text-sm font-semibold text-green-600";
                } else {
                    displays.revenueDiff.textContent = `${formatEuro(revDiff)} (${revDiffPct.toFixed(1)}%)`;
                    displays.revenueDiff.className = "mt-2 text-sm font-semibold text-red-600";
                }
            }

            // Update New Volume
            if (displays.newVol) displays.newVol.textContent = formatNum(v2) + " kpl";
            if (displays.volDiff) {
                const volDiffCount = v2 - v1;
                const volDiffPct = (volDiffCount / v1) * 100;
                displays.volDiff.textContent = `${volDiffCount >= 0 ? '+' : ''}${formatNum(volDiffCount)} kpl (${volDiffPct >= 0 ? '+' : ''}${volDiffPct.toFixed(1)}%)`;
            }

            // Table updates
            if (displays.tableOrigPrice) displays.tableOrigPrice.textContent = formatEuro(p1);
            if (displays.tableNewPrice) displays.tableNewPrice.textContent = formatEuro(p2);
            if (displays.tableOrigVol) displays.tableOrigVol.textContent = formatNum(v1) + " kpl";
            if (displays.tableNewVol) displays.tableNewVol.textContent = formatNum(v2) + " kpl";
            if (displays.tableOrigRev) displays.tableOrigRev.textContent = formatEuro(r1);
            if (displays.tableNewRev) displays.tableNewRev.textContent = formatEuro(r2);

            updateChart(p1, p2, optimalPrice, getRev);

            if (displays.insightBox) {
                if (p2 > p1 && revDiff < 0) {
                    displays.insightBox.className = "p-4 rounded-xl text-sm bg-orange-50 text-orange-800 border border-orange-200";
                    displays.insightBox.textContent = "Hinnan korotus laskee volyymia niin paljon, että liikevaihto laskee. Kysyntä on liian herkkää.";
                } else if (revDiff > 0) {
                    displays.insightBox.className = "p-4 rounded-xl text-sm bg-green-50 text-green-800 border border-green-200";
                    displays.insightBox.textContent = `Tämä hintapiste on kannattava. Huomaa, että optimaalinen hinta on ${formatEuro(optimalPrice)}.`;
                } else {
                    displays.insightBox.className = "p-4 rounded-xl text-sm bg-red-50 text-red-800 border border-red-200";
                    displays.insightBox.textContent = "Hinnan lasku ei kasvata volyymia tarpeeksi peittääkseen yksikköhinnan menetystä.";
                }
            }
        }

        function updateChart(currentPrice, simulatedPrice, optimalPrice, revFn) {
            const canvas = document.getElementById('revenueChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            
            const labels = [];
            const data = [];
            const minP = currentPrice * 0.2;
            const maxP = currentPrice * 2.0;
            const step = (maxP - minP) / 50;

            for (let p = minP; p <= maxP; p += step) {
                labels.push(p);
                data.push(revFn(p));
            }

            if (revenueChart) {
                revenueChart.destroy();
            }

            revenueChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Liikevaihto (€)',
                        data: data,
                        borderColor: '#cbd5e1',
                        borderWidth: 2,
                        fill: false,
                        pointRadius: 0,
                        tension: 0.4
                    },
                    {
                        label: 'Simuloitu',
                        data: [{x: simulatedPrice, y: revFn(simulatedPrice)}],
                        backgroundColor: '#3b82f6',
                        borderColor: '#3b82f6',
                        pointRadius: 6,
                        showLine: false
                    },
                    {
                        label: 'Optimi',
                        data: [{x: optimalPrice, y: revFn(optimalPrice)}],
                        backgroundColor: '#10b981',
                        borderColor: '#10b981',
                        pointRadius: 6,
                        showLine: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            title: { display: true, text: 'Hinta (€)' },
                            grid: { display: false }
                        },
                        y: {
                            title: { display: true, text: 'Liikevaihto (€)' },
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                label: (context) => `Liikevaihto: ${formatEuro(context.parsed.y)}`
                            }
                        }
                    }
                }
            });
        }

        function setupSync(rangeId, numId) {
            const range = document.getElementById(rangeId);
            const num = document.getElementById(numId);
            if (!range || !num) return;
            range.addEventListener('input', () => { num.value = range.value; calculate(); });
            num.addEventListener('input', () => {
                if (parseFloat(num.value) > parseFloat(range.max)) num.value = range.max;
                if (parseFloat(num.value) < parseFloat(range.min)) num.value = range.min;
                range.value = num.value;
                calculate();
            });
        }

        setupSync('origPrice', 'origPriceNum');
        setupSync('newPrice', 'newPriceNum');
        setupSync('origVol', 'origVolNum');
        setupSync('elasticity', 'elasticityNum');

        window.onload = calculate;
    </script>
</body>
</html>
